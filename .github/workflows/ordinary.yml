name: ç”Ÿæˆè¡¥ä¸æ–‡ä»¶ï¼ˆä»æŒ‡å®š Commitï¼‰

on:
  workflow_dispatch:
    inputs:
      REPO_URL:
        description: "Git ä»“åº“åœ°å€"
        required: true
        default: "https://github.com/cctv18/android_kernel_oneplus_mt6989.git"
      COMMIT_HASH:
        description: "è¦å¯¼å‡ºçš„ Commit å“ˆå¸Œå€¼"
        required: true
      PATCH_NAME:
        description: "è¾“å‡ºè¡¥ä¸æ–‡ä»¶å"
        required: true
        default: "fengchi_scx.patch"
      REVERSE:
        description: "æ˜¯å¦ç”Ÿæˆåå‘è¡¥ä¸"
        required: true
        type: boolean
        default: false
      CLEAN_HEADER:
        description: "æ˜¯å¦åˆ é™¤è¡¥ä¸ä¸­çš„ commit å¤´éƒ¨ä¿¡æ¯"
        required: true
        type: boolean
        default: true

jobs:
  gen-patch:
    runs-on: ubuntu-latest
    steps:
      - name: âœ… å…‹éš†ä»“åº“
        run: |
          git clone ${{ github.event.inputs.REPO_URL }} repo
          cd repo
          git fetch --all

      - name: ğŸ“Œ ç”Ÿæˆè¡¥ä¸
        run: |
          cd repo
          if [ "${{ github.event.inputs.REVERSE }}" = true ]; then
            echo "æ­£åœ¨ç”Ÿæˆåå‘è¡¥ä¸..."
            git show -R ${{ github.event.inputs.COMMIT_HASH }} --no-commit-id -p > ../${{ github.event.inputs.PATCH_NAME }}
          else
            echo "æ­£åœ¨ç”Ÿæˆæ­£å¸¸è¡¥ä¸..."
            git show ${{ github.event.inputs.COMMIT_HASH }} --no-commit-id -p > ../${{ github.event.inputs.PATCH_NAME }}
          fi

      - name: ğŸ§¹ å¯é€‰ï¼šåˆ é™¤è¡¥ä¸å¤´éƒ¨ commit ä¿¡æ¯
        if: ${{ github.event.inputs.CLEAN_HEADER }}
        run: |
          sed -i '/^commit /,/^diff --git /{ /^diff --git /!d }' ${{ github.event.inputs.PATCH_NAME }}

      - name: ğŸ“¤ ä¸Šä¼ è¡¥ä¸æ–‡ä»¶
        uses: actions/upload-artifact@v4
        with:
          name: ${{ github.event.inputs.PATCH_NAME }}
          path: ${{ github.event.inputs.PATCH_NAME }}